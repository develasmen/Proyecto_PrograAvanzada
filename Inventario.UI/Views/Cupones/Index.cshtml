@model IEnumerable<Inventario.Abstracciones.ModelosParaUI.CuponDescuentoDto>
@{
    ViewBag.Title = "Cupones de descuento";
    var hayCupones = Model.Any();
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
        <h2 class="mb-0"><i class="fas fa-ticket-alt me-2"></i>@ViewBag.Title</h2>
        @Html.ActionLink("Nuevo cupon", "Crear", null, new { @class = "btn btn-primary" })
    </div>

    @if (!hayCupones)
    {
        <div class="alert alert-info">
            Aun no hay cupones registrados. Usa el boton "Nuevo cupon" para crear el primero.
        </div>
    }
    else
    {
        <div class="table-responsive shadow-sm rounded bg-white">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Codigo</th>
                        <th>Producto</th>
                        <th>Descuento</th>
                        <th>Vigencia</th>
                        <th>Estado</th>
                        <th>Usos</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var cupon in Model)
                    {
                        var vigente = DateTime.Now.Date >= cupon.FechaInicio.Date && DateTime.Now.Date <= cupon.FechaFin.Date;
                        <tr>
                            <td class="fw-semibold">@cupon.Codigo</td>
                            <td>@(string.IsNullOrEmpty(cupon.ProductoNombre) ? "Todos" : cupon.ProductoNombre)</td>
                            <td>@cupon.PorcentajeDescuento.ToString("0.##")%</td>
                            <td>
                                @cupon.FechaInicio.ToString("dd/MM/yyyy") -
                                @cupon.FechaFin.ToString("dd/MM/yyyy")
                                <span class="badge @(vigente ? "bg-success" : "bg-secondary") ms-2">
                                    @(vigente ? "Vigente" : "Fuera de vigencia")
                                </span>
                            </td>
                            <td>
                                <span class="badge @(cupon.Activo ? "bg-primary" : "bg-danger")">
                                    @(cupon.Activo ? "Activo" : "Inactivo")
                                </span>
                            </td>
                            <td>
                                @cupon.UsosRealizados
                                @if (cupon.LimiteUso.HasValue)
                                {
                                    <span class="text-muted">/ @cupon.LimiteUso</span>
                                }
                            </td>
                            <td class="text-center">
                                <div class="btn-group">
                                    <a class="btn btn-sm btn-outline-secondary" href="@Url.Action("Editar", new { id = cupon.Id })">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a class="btn btn-sm btn-outline-danger" href="@Url.Action("Eliminar", new { id = cupon.Id })">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>
